---
title: 暗黑模式一
date: 2022-08-25 16:01:09
tags:
---
## 一、简介

从 iOS 13.0 版本开始，用户可以选择采用系统范围内的浅色或深色外观。 深色外观（称为暗黑模式DarkMode）实现了许多应用程序已经采用的界面样式。 用户可以选择自己喜欢的美学，也可以选择根据环境照明条件或特定时间表来切换其界面。苹果强烈建议支持深色模式。

## 二、支持暗黑模式
1.在Assets中添加自定义颜色

3.更新自定义视图的具体方法
当用户更改系统外观时，系统会自动要求每个窗口和视图重绘自身。 在此过程中，系统将调用下表中列出的几种众所周知的方法来更新您的内容。 系统在调用这些方法之前会更新特征环境，因此，如果要进行了所有外观敏感的更改，则应用程序会正确的进行更新。

UIView:
-traitCollectionDidChange:
-layoutSubviews
-drawRect:
-updateConstraints
-tintColorDidChange

UIViewController:
-traitCollectionDidChange:
-updateViewConstraints
-viewWillLayoutSubviews
-viewDidLayoutSubviews

UIPresentationController:
-traitCollectionDidChange:
-containerViewWillLayoutSubviews
-containerViewDidLayoutSubviews
当用户在明暗界面之间切换时，系统会要求你的应用重新绘制所有内容。虽然系统管理绘图过程，但在绘图过程中的几个点上，它依赖于您的自定义代码。您的代码必须尽可能快，并且不能执行与外观变化无关的任务。
如果需要根据当前模式的变化来修改界面，可以重写traitCollectionDidChange:方法进行更新

```
- (void) traitCollectionDidChange:(UITraitCollection *)previousTraitCollection
{
    [super traitCollectionDidChange:previousTraitCollection];
    UIUserInterfaceStyle userInterfaceStyle = previousTraitCollection.userInterfaceStyle;
    // 更新视图
}
```
然而并不是每次系统调用traitCollectionDidChange:方法时，模式都有变化，也有可能是设备进行了旋转也会调用traitCollectionDidChange:方法，所以此时需要判断系统主题模式是否发生了改变

```
- (void) traitCollectionDidChange:(UITraitCollection *)previousTraitCollection
{
    [super traitCollectionDidChange:previousTraitCollection];
    
    UITraitCollection *traitCollection = [UITraitCollection currentTraitCollection];// 获取当前的TraitCollection
    BOOL hasUserInterfaceStyleChanged = [previousTraitCollection hasDifferentColorAppearanceComparedToTraitCollection:traitCollection];
    // 根据当前模式更新视图
}
```

## 三、禁止暗黑模式
1、全局整个应用
可以在info.list中加入键值对UIUserInterfaceStyle对应值为Light字符串
```
<key>UIUserInterfaceStyle</key> <string>Light</string>
```
苹果强烈建议支持暗黑模式。当你致力于改善应用程序的暗模式支持时可以使用UIUserInterfaceStyle键来暂时来退出暗黑模式。
2、具体的UIViewController、UIView、UIWindow可以使用overrideUserInterfaceStyle属性来设置，通过overrideUserInterfaceStyle可以独立、灵活的设置应用、界面和视图的模式。

从iOS 13.0 开始UIViewController、UIView、UIWindow类都新增overrideUserInterfaceStyle属性
```
@property (nonatomic) UIUserInterfaceStyle overrideUserInterfaceStyle API_AVAILABLE(ios(13.0), tvos(13.0)) API_UNAVAILABLE(watchos);
```
UIUserInterfaceStyle枚举类型
```
typedef NS_ENUM(NSInteger, UIUserInterfaceStyle) {
    UIUserInterfaceStyleUnspecified,
    UIUserInterfaceStyleLight,
    UIUserInterfaceStyleDark,
} API_AVAILABLE(tvos(10.0)) API_AVAILABLE(ios(12.0)) API_UNAVAILABLE(watchos);
```
设置当前窗口的模式：
```
- (IBAction)changeModeAction:(id)sender {
    UIWindow *keyWindow = [UIApplication sharedApplication].windows.firstObject;
    if (keyWindow.overrideUserInterfaceStyle == UIUserInterfaceStyleDark)   
   {
        keyWindow.overrideUserInterfaceStyle = UIUserInterfaceStyleLight;
    }
    else
    {
        keyWindow.overrideUserInterfaceStyle = UIUserInterfaceStyleDark;
    }
}
```
设置具体视图控制器的模式：
 (void)viewDidLoad {
    [super viewDidLoad];
    self.overrideUserInterfaceStyle = UIUserInterfaceStyleLight;
}

